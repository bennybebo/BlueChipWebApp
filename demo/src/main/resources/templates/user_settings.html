<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap & Vendor CSS -->
  <link rel="stylesheet" th:href="@{/assets/vendors/css/vendor.bundle.base.css}">
  <!-- Material Design Icons -->
  <link rel="stylesheet" th:href="@{/assets/vendors/mdi/css/materialdesignicons.min.css}">
  <!-- Plugins (same as dashboard for consistency) -->
  <link rel="stylesheet" th:href="@{/assets/vendors/jvectormap/jquery-jvectormap.css}">
  <link rel="stylesheet" th:href="@{/assets/vendors/flag-icon-css/css/flag-icon.min.css}">
  <link rel="stylesheet" th:href="@{/assets/vendors/owl-carousel-2/owl.carousel.min.css}">
  <link rel="stylesheet" th:href="@{/assets/vendors/owl-carousel-2/owl.theme.default.min.css}">
  <!-- Layout styles -->
  <link rel="stylesheet" th:href="@{/assets/css/style.css}">
  <!-- Favicon -->
  <link rel="shortcut icon" th:href="@{/assets/images/favicon.png}" />

  <!-- Page-specific light touch (reuses your theme variables) -->
  <style>
    /* Moves Select Sports button on navabar down */
    #navbarButtonUnique {
      position: relative;
      top: 20px;       
    }

  </style>

  <title>User Settings</title>
</head>
<body class="body">
  <div class="container-scroller">
    <!-- Sidebar -->
    <div th:insert="~{partials/sidebar :: sidebar(marketType=${marketType}, sportKey=${sportKey}, availableSports=${availableSports})}"></div>

    <div class="container-fluid page-body-wrapper">
      <!-- Navbar -->
      <div th:insert="~{partials/navbar :: navbar(user=${user})}"></div>

      <!-- Main Panel -->
      <div class="main-panel">
        <div class="content-wrapper">
          <div class="row justify-content-center">
            <div class="col-12 settings-container">
              <div class="card settings-card">
                <div class="card-body">
                  <div class="d-flex align-items-center justify-content-between flex-wrap">
                    <h4 class="card-title mb-0">User Settings</h4>
                    <!-- Optional: place for future actions -->
                  </div>

                  <!-- Success Alert -->
                  <div th:if="${success}" class="alert alert-success mt-3 mb-4" role="alert">
                    <i class="mdi mdi-check-circle-outline mr-2"></i> Saved!
                  </div>

                  <form th:action="@{/settings}" th:object="${form}" method="post" class="mt-3">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                    <!-- Bankroll (USD) -->
                    <div class="form-group">
                      <label for="bankrollDollars" class="font-weight-medium">Bankroll (USD)</label>
                      <div class="input-group">
                        <div class="input-group-prepend">
                          <span class="input-group-text">
                            <i class="mdi mdi-currency-usd"></i>
                          </span>
                        </div>
                        <input id="bankrollDollars"
                               class="form-control"
                               type="number"
                               step="0.01"
                               min="0"
                               th:field="*{bankrollDollars}"
                               required
                               placeholder="0.00">
                      </div>
                      <small class="settings-hint">Total bankroll used for stake sizing.</small>
                      <div th:if="${#fields.hasErrors('bankrollDollars')}"
                           th:errors="*{bankrollDollars}"
                           class="text-danger mt-1"></div>
                    </div>

                    <!-- Kelly Fraction -->
                    <div class="form-group mt-3">
                      <label for="preferredKellyFraction" class="font-weight-medium">Kelly Fraction (0â€“1)</label>
                      <div class="input-group">
                        <div class="input-group-prepend">
                          <span class="input-group-text">
                            <i class="mdi mdi-chart-bell-curve-cumulative"></i>
                          </span>
                        </div>
                        <input id="preferredKellyFraction"
                               class="form-control"
                               type="number"
                               step="0.05"
                               min="0"
                               max="1"
                               th:field="*{preferredKellyFraction}"
                               required
                               placeholder="e.g., 0.5">
                      </div>
                      <small class="settings-hint">e.g., 0.5 for half-Kelly.</small>
                      <div th:if="${#fields.hasErrors('preferredKellyFraction')}"
                           th:errors="*{preferredKellyFraction}"
                           class="text-danger mt-1"></div>
                    </div>

                    <!-- Actions -->
                    <div class="mt-4 d-flex align-items-center">
                      <button type="submit" class="btn btn-primary mr-2">
                        <i class="mdi mdi-content-save-outline mr-1"></i> Save
                      </button>
                      <a th:href="@{/}" class="btn btn-inverse-secondary">Cancel</a>
                    </div>
                  </form>
                </div>
              </div>

              <!-- Optional: helpful info card -->
              <div class="card mt-3">
                <div class="card-body">
                  <h6 class="card-title mb-2">How these settings are used</h6>
                  <p class="mb-2 text-muted">
                    Your bankroll and Kelly fraction help calculate recommended stake sizes shown across the app.
                  </p>
                </div>
              </div>
              <!-- TODO: Remove this when real premium is set up -->
              <div class="mb-2">
                <span class="badge" th:classappend="${isPremium} ? ' badge-success' : ' badge-secondary'">
                  <span th:text="${isPremium} ? 'Premium' : 'Free'">Free</span>
                </span>
              </div>

              <form th:action="@{/settings/toggle-premium}" method="post" class="mt-2">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <button type="submit"
                        class="btn"
                        th:classappend="${isPremium} ? ' btn-outline-warning' : ' btn-success'">
                  <i class="mdi" th:classappend="${isPremium} ? ' mdi-cancel' : ' mdi-star'"></i>
                  <span th:text="${isPremium} ? 'Disable Premium' : 'Enable Premium'">Enable Premium</span>
                </button>
              </form>
            </div>
          </div>
        </div>
        <!-- content-wrapper ends -->
      </div>
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller ends -->

  <!-- Vendor JS -->
  <script th:src="@{/assets/vendors/js/vendor.bundle.base.js}"></script>
  <!-- Plugins (kept in parity with dashboard; harmless here) -->
  <script th:src="@{/assets/vendors/chart.js/Chart.min.js}"></script>
  <script th:src="@{/assets/vendors/progressbar.js/progressbar.min.js}"></script>
  <script th:src="@{/assets/vendors/jvectormap/jquery-jvectormap.min.js}"></script>
  <script th:src="@{/assets/vendors/jvectormap/jquery-jvectormap-world-mill-en.js}"></script>
  <script th:src="@{/assets/vendors/owl-carousel-2/owl.carousel.min.js}"></script>
  <!-- Inject JS -->
  <script th:src="@{/assets/js/off-canvas.js}"></script>
  <script th:src="@{/assets/js/hoverable-collapse.js}"></script>
  <script th:src="@{/assets/js/misc.js}"></script>
  <script th:src="@{/assets/js/settings.js}"></script>
  <script th:src="@{/assets/js/todolist.js}"></script>
</body>
</html>
